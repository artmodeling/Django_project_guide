# Миграция, маршрут, создание суперпользователя, модели, шаблона

## Миграция
1.	Для того, чтобы проект мог работать с базами данных, нужно выполнить миграции. В данном случае это означает, что нужно выполнить определенные команды, чтобы система создала инструкции для того, чтобы были выполнены необходимые действия с базами данных.
2.	Выполняются эти команды при остановленном сервере или в другой вкладке (в новом терминале), при этом необходимо проследить, чтобы там было запущено то же самое виртуально окружение.
3.	Активировать виртуальное окружение командой:
    1)	Если это Windows, необходимо выполнить эту команду. Поскольку в данном случае работы выполняются в операционной системе (ОС) Windows, нужно выбрать этот вариант:  
    ```
    source venv/Scripts/activate
    ```
    2)	Если это Linux или Mac:  
    ```
    source venv/bin/activate
    ```
4.	Команды для выполнения миграции:
    1)	Выполнить команду для создания миграций:  
    ```
    python manage.py makemigrations
    ```  
    2)	Создать инструкцию для Джанго, что ему нужно сделать, чтобы появились таблицы в БД:  
    ```
    python manage.py migrate
    ```  
5.	После этого можно запустить сервер, перед этим проследите, что находитесь в папке нужного проекта:  
```
python manage.py runserver
```

 
## Расширение SQLite Viewer  в VSC для просмотра таблиц, созданных в .sqlite3
6.	Расширение называется «SQLite Viewer». С его помощью можно просматривать таблицы, созданные в базе данных (БД) .sqlite3.
7. 	Как установить расширение «SQLite Viewer»:
    1)	В VSC в левом нижнем углу перейти в настройки (иконка «шестеренка»), в выпадающем меню нажать на пункт «Расширения» (Extensions):  
    <picture>
    <img alt="(001)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/001.png">
    </picture>
    
    2)	В строке поиска, которая появится в верхнем левом углу набрать точное название расширения – «`SQLite Viewer`»:  
    <picture>
    <img alt="(002)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/002.png">
    </picture>

    3)	В появившемся списке расширений нужно найти то, имя которого полностью совпадает с указанным – «SQLite Viewer», если расширений с таким именем несколько, стоит выбрать тот, у которого такая же иконка, как на изображениях ниже:  
    <picture>
    <img alt="(003)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/003.png">
    </picture>

    4)	Нажать на кнопку «`Install`»:  
        * здесь:  
        <picture>
        <img alt="(004)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/004.png">
        </picture>

        * или здесь:  
        <picture>
        <img alt="(005)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/005.png">
        </picture>

    5)	На запрос системы нажать на кнопку «`Trust Publisher & Install`»:  
    <picture>
    <img alt="(006)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/006.png">
    </picture>

    6)	Определить, что расширение установилось, можно, например, такими способами:  
        * Исчезнет кнопка «`Install`», появятся кнопки «`Disable`» (сделать неактивным) и «`Unistall`» (деинсталлировать, то есть, удалить это расширение) -  
        <picture>
        <img alt="(007)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/007.png">
        </picture>

        * Если очистить строку поиска, то это расширение появится в списке установленных расширений:  
        <picture>
        <img alt="(008)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/008.png">
        </picture>

    7)	После этого можно просматривать содержимое БД:  
    <picture>
    <img alt="(009)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/009.png">
    </picture>


## Создание суперпользователя (опционально)

8.	Для того, чтобы войти в админку сайта, нужен пользователь. Для этого можно создать суперпользователя, который будет иметь возможность делать абсолютно все в админке.
9.	Создать суперпользователя командой:  
    ```
    python manage.py createsuperuser
    ```  
    - На запросы системы при его создании можно давать такие ответы:  
        -	Username - можно указать `admin`,  
        -	Email - можно оставить пустым,  
        -	Password - можно сделать, как Username, то есть, admin, хотя это небезопасно (несекьюрно), джанго будет на него ругаться, но мы можем сказать ему "пропустить". Лучше, конечно, так не делать. Но для тестового или учебного процесса такой пароль можно допустить.  

 
## Вход в админку сайта

10.	Для входа в админку необходимо перейти на сайт по адресу, который указывает сервер при старте, и дописать к нему `/admin/` , в появившейся форме ввести логин и пароль, которые были указаны при создании суперпользователя, и нажать кнопку «`Log in`»:  
<picture>
<img alt="(010)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/010.png">
</picture>


## Создание модели

11.	Для того, чтобы в админке появилась таблица, которая нужна нам, ее нужно создать и зарегистрировать.
12.	Создание модели:
    1) Код для модели пишем сами на python.
    2) Перейти в файл «`store/models.py`».
    Внести в него, например, такой код, следить за форматированием, нужны отступы слева и пустые строки между строкам, как указано ниже:
    ```
    from django.db import models

    class Products(models.Model):
    product_name = models.CharField(max_length=200, verbose_name="Наименование товара")
    about_item = models.TextField(verbose_name="Подробнее о товаре")
    created_at = models.DateTimeField(auto_now_add=True) # Дата добавления товара на сайт.

    class Meta:
        verbose_name = 'товар'
        verbose_name_plural = 'товары'
        db_table = 'products'

    def __str__(self):
        return self.product_name
    ``` 

    3)	Чтобы русифицировать названия элементов модели, как раз и используется «`verbose_name`». Если его не указать, то названия этих элементов в админке будут на английском языке.  
    4)	Если нужно русифицировать всю админку, то необходимо выполнить следующее:  
        *	зайти в файл «`config/settings.py`»,  
        *	найти константу «`LANGUAGE_CODE`», для быстрого поиска можно нажать комбинацию клавиш `Ctrl+Shift+.` (точка в конце),  
        *	указать новое значение переменной «`ru-ru`».  

13. Теперь нужно сообщить Джанго, что создана новая модель и для нее в БД нужно создать отдельную таблицу. Для этого выполняются миграции.  
14. Создание миграций:  
    1)	Выполнить команду для создания миграций:  
    ```
    python manage.py makemigrations
    ```  
    2)	Создать инструкцию для джанго, что ему нужно сделать, чтобы появились таблицы в БД:  
    ```
    python manage.py migrate
    ```  
 
## Регистрация модели в админке.
15. Для того, чтобы в админке сайта можно было добавлять товары, вносить в них изменения, нужно новую модель зарегистрировать. Делается это следующим образом:  
В файле `store/admin.py` записать, например, такой код, комментарии из кода можно удалить, следить за форматированием, нужны пустые строки между строками, как указано ниже:  
```
# Эта строка стоит в этом файле по умолчанию. Оставить ее без изменений.
from django.contrib import admin

# В этой строке в Джанго из файла store/models.py импортируется модель (класс) Products.
from store.models import Products

# В этой строке для Джанго сообщается, что нужно в админке (admin) сайта (site) зарегистрировать (register) модель «Products» (Products).
admin.site.register(Products)


```
16. После этого новая модель появится в админке сайта:  
<picture>
<img alt="(011)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/011.png">
</picture>

17. Если до этого в файл "`.gitignore`" не была добавлена папка "`migrations/`" (в конце слова "migrations/" обязательно нужно добавить слэш, для обозначения того, что это именно папка, а не файл), то сейчас ее нужно туда добавить:  
<picture>
<img alt="(012)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/012.png">
</picture>

18. (Опционально.) Создать коммит: "feat(store): Создал модель карточки товара и зарегистрировал в админке.".  
    1) На гитхабе проверить, что:  
        - появился новый коммит,  
        - файл «`store/migrations/\_\_init__.py`» на гитхабе после коммита остался пустым. Он и дальше должен оставаться пустым, потому что Джанго пишет туда инструкции для миграции моделей, они занимают много места. На гитхаб отправлять их не нужно, чтобы не загромождать там место.  

## Создание новой карточки товара

19. Карточка товара создается уже в админке сайта:  
    1) Перейти в папку «`STORE/Товары`»:  
    <picture>
    <img alt="(013)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/013.png">
    </picture>

    2) В правом верхнем углу нажать на кнопку «`Добавить товар`»:  
    <picture>
    <img alt="(014)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/014.png">
    </picture>

    3) Заполнить необходимые поля:  
    <picture>
    <img alt="(015)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/015.png">
    </picture>

    4) Сохранить внесенные изменения, нажав на одну из кнопок для сохранения:  
        - «`Сохранить`» - сохранить изменения и вернуться в список товаров,  
        - «`Сохранить и добавить другой объект`» - сохранить изменений и, не возвращаясь в список товаров, добавить новый товар,  
        - «`Сохранить и продолжить редактирование`» - сохранить изменения и остаться на этой странице, чтобы продолжить редактировать данную карточку товара:  
        <picture>
        <img alt="(016)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/016.png">
        </picture>

    5) Пример заполнения:  
    <picture>
    <img alt="(017)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/017.png">
    </picture>

    6) Пример результата в списке товаров:  
    <picture>
    <img alt="(018)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/018.png">
    </picture>


## Зачем нужен метод "\_\_str__" в файле "store/models.py"

Он нужен для того, чтобы в админке правильно отображались заголовки постов. Если его не указать, то в админке вместо наименований товаров будет указываться «`Products object (1)`», что совершенно неудобно для работы. Чтобы это проверить, можно в файле «store/models.py» закомментировать все строки у функции «`def \__str__(self)`» и посмотреть изменения на странице со списком товаров.

## Что такое "Django ORM"

Подробнее – в видео лекции №23 с момента 01-20-01.

## Пример загрузки и запуска этого проекта на новом устройстве

Подробнее – в видео лекции №23 с момента 01-30-29.

## Создание интерфейса для пользователя

(В видео только заявлено, не реализовано.)

## Создание списка товаров

Для того, чтобы на страницу сайта можно было вывести все товары в одном списке, необходимо выполнить следующие действия.  
20. Создание маршрута:  
    1) Код для файлов «`store/views.py`» и «`store/urls.py`» пишем сами.   
    2) Для начала можно в них внести эти коды, следить за форматированием, нужны отступы слева и пустые строки между строкам, как указано ниже, комментарии в самом коде можно не указывать:  
        a. в файле «`store/views.py`»:
            - здесь код файла приведен полностью, поэтому его можно полностью скопировать и полностью заменить внутри файла проекта,  
            - следить за форматированием, нужны отступы слева и пустые строки между строкам, как указано ниже, комментарии в коде можно не указывать:  

```
from django.shortcuts import render

from store.models import Products

# "request" в скобках указывать обязательно, можно поставить другое слово, но лучше указывать "request".
def get_product_list(request): 
    products = Products.objects.all()

# Здесь уже нужно создать первый шаблон. Путь 'blog/index.html' здесь не нужно указывать полный. 
# Джанго шаблоны ищет в папке "templates".
    return render(request, 'store/index.html', context={'products': products}) 

```
        
        b. и в файле «`store/urls.py`»:  
            - здесь код файла приведен полностью, поэтому его можно полностью скопировать и полностью заменить внутри файла проекта,  
            - следить за форматированием, нужны отступы слева и пустые строки между строкам, как указано ниже, комментарии в коде можно не указывать:  

```
from django.urls import path
from . import views

urlpatterns = [
    # Временно закомментировали маршрут на главную страницу. С ней будем работать позже.
    # path("", ) 
    # В следуюих строчках:
    # - слэш "/" после "products" ставить обязательно. 
    # - и "views.get_product_list" пишем без круглых скобок, 
    # потому что если написать так: "views.get_product_list()", то это будет вызов функции. Здесь это не нужно.
    # Вместо "products" можно указать, что угодно. 
    path("products/", views.get_product_list) 
]

```

Для того, чтобы эти коды заработали, нужно создать `шаблон HTML`.

 
## Создание шаблона HTML

21. Установка расширения для работы с шаблоном HTML. Для создания шаблона используем сначала стандартный HTML-шаблон. После этого работаем с `DTL` - Django Template Language (Шаблонный язык Джанго). Можно поискать другие.  
    1)	Для того, чтобы этот DTL работал (была нужная подсветка, подсказки и т. д.), переходим в расширения Джанго и устанавливаем расширение `Django`:  
        a.	В левом нижнем углу нажать на иконку «шестеренка»:  
        <picture>
        <img alt="(019)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/019.png">
        </picture>

        b.	В VSC в левом нижнем углу перейти в настройки (иконка «шестеренка»), в выпадающем меню нажать на пункт «Расширения» (Extensions):  
        <picture>
        <img alt="(020)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/020.png">
        </picture>

        c.	В строке поиска набрать «`Django`»:  
        <picture>
        <img alt="(021)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/021.png">
        </picture>

        d.	В появившемся списке найти то расширение, имя которого полностью совпадает с «`Django`», если расширений с таким именем несколько, стоит выбрать тот, у которого такая же иконка, как на изображениях ниже:  
        <picture>
        <img alt="(022)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/022.png">
        </picture>

        e.	Нажать на кнопку «`Install`»:  
        <picture>
        <img alt="(023)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/023.png">
        </picture>

        f.	В появившемся диалоговом окне нажать на кнопку «`Trust Publisher & Install`»:  
        <picture>
        <img alt="(024)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/024.png">
        </picture>

    2)	Определить, что расширение установилось, можно следующими способами:  
        a.	Исчезнет кнопка «`Install`», появятся кнопки «`Disable`» (сделать неактивным) и «`Unistall`» (деинсталлировать, то есть, удалить это расширение) -  
        <picture>
        <img alt="(025)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/025.png">
        </picture>

        b.	Если очистить строку поиска, это расширение появится в списке установленных расширений:  
        <picture>
        <img alt="(026)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/026.png">
        </picture>

22. Перейти в проект.  
23. Подключить DTL - Django Template Language (Шаблонный язык Джанго) в Джанго, для того, чтобы в шаблоне HTML можно было писать формулы:  
    1) в правом нижнем углу экрана нажать на слово, обозначающее имя языка, возможно, там будет указано «Python» или «HTML» (если там уже не указано «Django HTML»),  
    2) в выпадающем меню, которое появится в верхней части экрана VSC, набрать «HTML» и в появившемся списке выбрать «Django HTML» -  
    <picture>
    <img alt="(027)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/027.png">
    </picture>

    3) в правом нижнем углу появится надпись «Django HTML» -  
    <picture>
    <img alt="(028)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/028.png">
    </picture>

    4) После этого в HTML файле можно будет писать формулы.  

24. Создание шаблона  
25. Для шаблонов принято в самом проекте (в данном случае – store, проследить, что находитесь в правильной/нужной папке) создавать папку «`templates`», в ней создавать еще одну папку с точным названием проекта, например, «store», и уже в ней создавать шаблоны для этого проекта. Немножко сложновато, но так устроены шаблоны в Джанго.
26. В данном случае нужно выполнить следующие действия:  
    1) Убедиться, что находитесь в главной папке проекта «`Online_store`». Это папка, в которой находятся все папки данного проекта и, например, такие файлы: db.sqlite3, manage.  py, README.md. Кроме них там лежат и другие файлы, но эти лежат именно в корневой (главной) папке проекта.  
    2) Из корневой папки перейти в папку «`store`».  
    3) И в папке «`store`» создать папку «`templates`». Название новой папки должно быть именно «`templates`» (без кавычек)! Это важно для работы Джанго.  
    4) В папке «`templates`» создать еще одну папку «`store`».  
    5) И уже в папке «`store`», которая лежит в папке «`templates`», создать файл «`index.html`» - в нем будет создан первый шаблон страницы HTML.  
    <picture>
    <img alt="(029)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/029.png">
    </picture>

 
## Создание шаблона HTML

27. **(Примечание.)** Для того, чтобы в файле шаблона HTML VSC работал с HTML кодом, нужно ему указать, что нужно использовать язык HTML. VSC может это определять сам. Выяснить, определил VSC это автоматически или нет, можно, посмотрев в нижнем правом углу экрана на строчку, похожую на ту, что на изображении ниже, в данном случае в VSC выбран язык python. На изображении ниже приведена только часть строки, так как начало строки может быть другим - 
<picture>
<img alt="(030)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/030.png">
</picture>

28. Если же VSC не определил язык автоматически, как на изображении выше, нужно его выбрать вручную: в правом нижнем углу экрана нажать на слово «Python» (если перед этим был открыт файл .py, как на изображении выше), в выпадающем меню, которое появится в верху VSC, в зависимости от того, что нужно делать в файле HTML выбрать нужный язык:
    1) Если нужно поработать с разметкой, тегами именно самого HTML-я, то необходимо выбрать «HTML (html).
    2) Если нужно поработать с формулами, то необходимо выбрать «Django HTML (django-html)»:
    <picture>
    <img alt="(031)" src="https://github.com/artmodeling/Django_project_guide/blob/main/Images/003_Migration_route_superuser_model_template/031.png">
    </picture>

29. В коде для цикла if можно сначала написать часть для else, потому как вариант поведения на странице в случае, если товаров в списке нет, только один.
30. Если выбран язык «Django HTML», то для начала выполнения команды можно начать набирать ключевое слово, в выпадающем списке выбрать нужный вариант оформления и нажать Enter, чтобы они правильно оформились и закрылись, так как в «Django HTML» их нужно закрывать, например: if, for, else. 
В файле «`store\templates\store\index.html`» можно написать, например, такой код, следить за форматированием, нужны отступы слева и пустые строки между строкам, как указано ниже:
```
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Все товары</title>
</head>
<body>
    <h1>Все товары</h1>
    {% comment %}
        Пример
        многострочного
        комментария.
        Всем привет!    
    {% endcomment %}
    {# Пример однострочного комментария. #}
    {% if products %}
        {% for product in products  %}
            <div class="product-container" style="border: 1px solid black; margin-bottom: 10px; padding: 15px;">
                <h2>Наименование товара: {{ product.product_name }} </h2>
                <p>Подробнее о товаре: {{ product.about_item }} </p>
                <small>Дата добавления товара на сайт: {{ product.created_at }} </small>
            </div>
        {% endfor %}
    {% else %}
        <p>Страница находится в разработке. Пожалуйста, зайдите к нам позже.</p>
    {% endif %}
    
</body>
</html>
```

31. Убедиться, что в файле «`config\urls.py`» прописаны маршруты как в коде ниже с соблюдением пустых строк между строками с кодом и отступов от края слева:
```
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path("", include("store.urls")),
]

```

32. На странице сайта проверить, что на странице http://127.0.0.1:8000/products/ появился список товаров:
    1) выйти из админки,
    2) в конце адреса http://127.0.0.1:8000 дописать `/products/`, чтобы получился адрес `http://127.0.0.1:8000/products/` и нажать Enter,
    3) по указанному адресу откроется страница, где будет выведен список товаров, карточки для которых были заполнены в админке.
33. (Опционально.) Создать и запушить коммит. Текст его может быть, например, таким: «feat(template): Создал шаблон для списка товаров и прописал маршрут для него.»
